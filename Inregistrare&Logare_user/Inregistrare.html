<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Registration</title>
  <link rel="stylesheet" href="U:\Plan_Afacere\WebSite\ComputerLaptop_WebSite\style_main\form.css" type="text/css" media="screen">
</head>
<body>
  <form action="\WebSite\server\public\Inregistrare&Logare_user\Database_connection_credentials_sent.js" id="InregistrareForm" class="form-container" method="post" formtarget="_blank">
    <div class="container_pagina_inregistrare">
      <h2>Inregistrare</h2>
      <p style="border: 1px solid; background-color: whitesmoke; border-radius: 20px;">Completeaza campurile de mai jos cu datele personale pentru a crea un cont!</p>
      <label for="email"><b>Email</b></label>
      <input type="text" placeholder="Introdu adresa de Email" name="email" required>
      <label for="password"><b>Parola</b></label>
      <input type="password" placeholder="Introdu Parola:" name="password" required>
      <label for="password_repeat"><b>Repeta Parola</b></label>
      <input type="password" placeholder="Repeta Parola:" name="password_repeat" required>
      <label>
        <input type="checkbox" checked="checked" name="remember"> Tine minte datele de conectare
      </label>
      <p>Creandu-ti un cont, esti de acord cu 
        <a href="#link" style="background: linear-gradient(65deg, #e0c8ae 35%,rgb(77, 94, 100)70%, #563939) 80%; text-decoration: wavy;">Termenele & Conditiile</a>.
      </p>
      <div class="clearfix">
        <button type="submit" class="signupbtn" style="background: linear-gradient(35deg, #ffefde 55%,rgb(58, 155, 188)70%, #00171f) 80%;">Inregistreaza-te</button>
      </div>
    </div>
  </form>

  <script>
    // Retry mechanism
    const retryLimit = 3;
    let retries = 0;

    document.getElementById('InregistrareForm').addEventListener('submit', async (event) => {
      event.preventDefault();

      const formData = new FormData(event.target);
      const formObject = {};
      formData.forEach((value, key) => {
        formObject[key] = value;
      });

      const response = await fetch('http://192.168.100.53:8081/WebSite\server\public\Inregistrare&Logare_user\Database_connection_credentials_sent.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formObject)
      });

      if (!response.ok && retries < retryLimit) {
        retries++;
        console.error(`Failed to register user. Retrying attempt ${retries}...`);
        event.target.submit();
      } else if (!response.ok && retries >= retryLimit) {
        console.error('Maximum retry limit reached. Could not register user.');
      } else {
        retries = 0;
        const data = await response.json();
        console.log('User registered successfully:', data);
      }
    });
  </script>
</body>
</html>
